<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.406">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>

<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="README_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="big-fish-smfish-spot-quantification-scripts" class="level1">
<h1>Big-FISH smFISH spot quantification scripts</h1>
<p>Pre-process and quantify single-molecule Fluorescence in situ Hybridisation images using a python package Big-FISH: https://github.com/fish-quant/big-fish.</p>
<p>Measure (1) individual spot counts in the cell + (2) spot counts within signal dense regions.</p>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<section id="set-up-virtual-conda-environment" class="level3">
<h3 class="anchored" data-anchor-id="set-up-virtual-conda-environment">Set up virtual conda environment</h3>
<p>Make sure to use x86 version of Miniconda3, not the arm64 version (even if using M1 mac computers): https://docs.conda.io/en/latest/miniconda.html</p>
<pre><code>conda create -n bigfish_v6 python=3.7
conda activate bigfish_v6

# virtual environment can be detactivated as follows
conda deactivate</code></pre>
</section>
<section id="bigfish-installation" class="level3">
<h3 class="anchored" data-anchor-id="bigfish-installation">BigFISH installation</h3>
<pre><code>pip install big-fish
pip install ipykernel
pip install jupyterlab

# if segmenting tissue culture cells also install cellpose (the version may need to be 0.7.2)
pip install cellpose </code></pre>
</section>
</section>
<section id="smfish-quantification" class="level2">
<h2 class="anchored" data-anchor-id="smfish-quantification">smFISH quantification</h2>
<section id="optimise-parameters" class="level3">
<h3 class="anchored" data-anchor-id="optimise-parameters">Optimise parameters</h3>
<p>Use <code>smFISH-quantification_optimise-parameters.ipynb</code> notebook to determine smFISH quantification parameters on a few subset of images.</p>
<pre><code>cd /path/to/working/directory/
jupyter lab</code></pre>
<p>Following should be determined from the notebook:</p>
<ul>
<li>Image voxel size and PSF parameters</li>
<li>Image channels to quantify (0-based)</li>
<li>Whether auto thresholding will be used
<ul>
<li>requires a fair number of spots within the image</li>
<li>signal-to-background ratio of smFISH spots should be &gt; 2 in raw images for reliable use</li>
</ul></li>
<li>If not using automated thresholding, find a suitable manual intensity threshold
<ul>
<li>Draw several line profiles over smFISH spots in <code>rna_log.tif</code> on ImageJ to find a suitable threshold</li>
</ul></li>
<li>Dense region decomposition parameters
<ul>
<li>how wide the dense regions should be? (<code>bf_radius</code> in nanometers)</li>
<li>minimum number of spots within a dense region for it to be considered a cluster (<code>nb_min_spots</code>)</li>
</ul></li>
</ul>
</section>
<section id="batch-processing-multiple-images" class="level3">
<h3 class="anchored" data-anchor-id="batch-processing-multiple-images">Batch processing multiple images</h3>
<p>Port the pre-determined quantification parameters to <code>smFISH_analysis_config.yaml</code> file.</p>
<section id="general-configuration" class="level4">
<h4 class="anchored" data-anchor-id="general-configuration">General configuration</h4>
<ul>
<li><code>number_of_workers</code>: Number of CPUs to use</li>
<li><code>input_pattern</code>: Input image directory - use wildcard to grab the images</li>
<li><code>output_dir</code>: Directory where spot and cluster coordinates will be saved</li>
<li><code>output_qc_dir</code>: Directory where quality control files will be saved (e.g.&nbsp;reference spot, elbow plot..etc)</li>
</ul>
</section>
<section id="bigfish-configuration" class="level4">
<h4 class="anchored" data-anchor-id="bigfish-configuration">Bigfish configuration</h4>
<ul>
<li><p><code>voxel_size_yx</code>: XY voxel size in nm</p></li>
<li><p><code>voxel_size_z</code>: Z step voxel size in nm</p></li>
<li><p><code>ex</code>: Dye excitation maxima</p></li>
<li><p><code>em</code>: Dye emission maxima</p></li>
<li><p><code>NA</code>: Numerical aperture of the microscope objective</p></li>
<li><p><code>RI</code>: Refractive index of the mounting media</p></li>
<li><p><code>microscope</code>: Either ‘confocal’ or ‘widefield’</p></li>
<li><p><code>bg_radius</code>: Background subtraction kernel radius. Usually 5 is okay.</p></li>
<li><p><code>channels</code>: Image channels to quantify (0-based). Use [2, 3] or [2] format</p></li>
<li><p><code>auto_threshold</code>: True/False - Whether automated thresholding will be used</p></li>
<li><p><code>smFISH_ch1</code>: First smFISH channel number - should match the <code>channels</code> configuration</p></li>
<li><p><code>smFISH_ch1_thresh</code>: LoG filtered spot intensity threshold for the first channel</p></li>
<li><p><code>smFISH_ch2</code>: Second smFISH channel number</p></li>
<li><p><code>smFISH_ch2_thresh</code>: LoG filtered spot intensity threshold for the second channel</p></li>
<li><p><code>alpha</code>: 0.5 - Do not change</p></li>
<li><p><code>beta</code>: 1 - Do not change</p></li>
<li><p><code>bf_radius</code>: Cluster radius in nanometer</p></li>
<li><p><code>nb_min_spots</code>: Mimimum number of spots required for a dense region to be considered a cluster.</p></li>
</ul>
</section>
<section id="start-batch-process" class="level4">
<h4 class="anchored" data-anchor-id="start-batch-process">Start batch process</h4>
<p>Start the batch process by running the multiprocess python script. Make sure the YAML configuration file is in the same directory as the python script.</p>
<pre><code>cd /path/to/python/script/
python smFISH_data_analysis_multiprocess.py</code></pre>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>